import * as crypto from 'crypto';import { aliyunOssConfig } from '@/config/aliyun';export interface OSSUploadSignature {  accessId: string;        policy: string;          signature: string;       host: string;            expire: number;          dir: string;           }export const generateOSSUploadSignature = (  userId: string | number,  fileType: 'video' | 'image' = 'video'): OSSUploadSignature => {  const expireTime = Date.now() + aliyunOssConfig.signatureExpire * 1000;  const expireDate = new Date(expireTime);  const date = new Date();  const year = date.getFullYear();  const month = String(date.getMonth() + 1).padStart(2, '0');  const dir = `${fileType}s/${userId}/${year}/${month}/`;  const policyJson = {    expiration: expireDate.toISOString(),    conditions: [      ['content-length-range', 0, aliyunOssConfig.maxFileSize],      ['starts-with', '$key', dir],    ],  };  const policyBase64 = Buffer.from(JSON.stringify(policyJson)).toString('base64');  const signature = crypto    .createHmac('sha1', aliyunOssConfig.accessKeySecret)    .update(policyBase64)    .digest('base64');  return {    accessId: aliyunOssConfig.accessKeyId,    policy: policyBase64,    signature,    host: aliyunOssConfig.endpoint,    expire: Math.floor(expireTime / 1000),     dir,  };};export const isAllowedFileType = (mimeType: string): boolean => {  return aliyunOssConfig.allowedFileTypes.includes(mimeType);};export const getOSSFileUrl = (objectKey: string): string => {  return `${aliyunOssConfig.endpoint}/${objectKey}`;};export const getSignedOSSUrl = (  objectKey: string,  expiresIn: number = 3600): string => {  throw new Error('暂未实现私有 Bucket 签名 URL 功能');};
