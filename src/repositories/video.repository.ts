import prisma from '@/prisma/client';import { Video, VideoStatus, Prisma } from '@prisma/client';export interface CreateVideoDto {  title: string;  description?: string;  coverUrl: string;  videoUrl: string;  duration: number;  authorId: bigint | string | number;  status?: VideoStatus;}export interface UpdateVideoDto {  title?: string;  description?: string;  coverUrl?: string;  videoUrl?: string;  duration?: number;  status?: VideoStatus;}export interface VideoQueryOptions {  authorId?: bigint | string | number;  status?: VideoStatus;  page?: number;  limit?: number;  orderBy?: 'createdAt' | 'updatedAt';  order?: 'asc' | 'desc';}export type VideoWithAuthor = Prisma.VideoGetPayload<{  include: { author: true };}>;export const createVideo = async (data: CreateVideoDto): Promise<Video> => {  const authorId = typeof data.authorId === 'bigint'     ? data.authorId     : BigInt(data.authorId);  return await prisma.video.create({    data: {      title: data.title,      description: data.description,      coverUrl: data.coverUrl,      videoUrl: data.videoUrl,      duration: data.duration,      authorId,      status: data.status || VideoStatus.DRAFT,     },  });};export const findVideoById = async (  id: bigint | string | number,  includeAuthor: boolean = false): Promise<Video | VideoWithAuthor | null> => {  const videoId = typeof id === 'bigint' ? id : BigInt(id);  return await prisma.video.findUnique({    where: { id: videoId },    include: includeAuthor ? { author: true } : undefined,  });};export const findVideos = async (  options: VideoQueryOptions = {}): Promise<{ videos: VideoWithAuthor[]; total: number }> => {  const {    authorId,    status,    page = 1,    limit = 20,    orderBy = 'createdAt',    order = 'desc',  } = options;  const where: Prisma.VideoWhereInput = {};  if (authorId) {    where.authorId = typeof authorId === 'bigint'       ? authorId       : BigInt(authorId);  }  if (status) {    where.status = status;  }  const skip = (page - 1) * limit;  const take = limit;  const [videos, total] = await Promise.all([    prisma.video.findMany({      where,      skip,      take,      orderBy: {        [orderBy]: order,      },      include: {        author: true,      },    }),    prisma.video.count({ where }),  ]);  return { videos, total };};export const updateVideo = async (  id: bigint | string | number,  data: UpdateVideoDto): Promise<Video> => {  const videoId = typeof id === 'bigint' ? id : BigInt(id);  return await prisma.video.update({    where: { id: videoId },    data,  });};export const deleteVideo = async (  id: bigint | string | number): Promise<Video> => {  const videoId = typeof id === 'bigint' ? id : BigInt(id);  return await prisma.video.delete({    where: { id: videoId },  });};export const countVideos = async (  authorId?: bigint | string | number,  status?: VideoStatus): Promise<number> => {  const where: Prisma.VideoWhereInput = {};  if (authorId) {    where.authorId = typeof authorId === 'bigint'       ? authorId       : BigInt(authorId);  }  if (status) {    where.status = status;  }  return await prisma.video.count({ where });};export const findVideosByAuthor = async (  authorId: bigint | string | number,  status?: VideoStatus,  page: number = 1,  limit: number = 20): Promise<{ videos: VideoWithAuthor[]; total: number }> => {  return await findVideos({    authorId,    status,    page,    limit,    orderBy: 'createdAt',    order: 'desc',  });};export const publishVideo = async (  id: bigint | string | number): Promise<Video> => {  return await updateVideo(id, { status: VideoStatus.PUBLISHED });};export const blockVideo = async (  id: bigint | string | number): Promise<Video> => {  return await updateVideo(id, { status: VideoStatus.BLOCKED });};
