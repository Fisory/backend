import { Request, Response } from 'express';import {   sendVerifyCode,   loginWithVerifyCode } from '@/services/auth.service';import {   successResponse,   errorResponse,   StatusCode } from '@/utils/response';export const sendCode = async (req: Request, res: Response): Promise<Response> => {  try {    const { phone } = req.body;    if (!phone) {      return errorResponse(        res,        '手机号不能为空',        StatusCode.MISSING_PARAMS      );    }    await sendVerifyCode(phone);    return successResponse(      res,      null,      '验证码发送成功'    );  } catch (error) {    console.error('❌ 发送验证码失败:', error);    const errorMessage = error instanceof Error ? error.message : '发送验证码失败';    if (errorMessage.includes('手机号格式')) {      return errorResponse(        res,        errorMessage,        StatusCode.INVALID_PHONE_NUMBER      );    } else if (errorMessage.includes('频繁')) {      return errorResponse(        res,        errorMessage,        StatusCode.SMS_SEND_FAILED      );    } else {      return errorResponse(        res,        errorMessage,        StatusCode.SMS_SEND_FAILED      );    }  }};export const login = async (req: Request, res: Response): Promise<Response> => {  try {    const { phone, code } = req.body;    if (!phone || !code) {      return errorResponse(        res,        '手机号和验证码不能为空',        StatusCode.MISSING_PARAMS      );    }    const { user, token } = await loginWithVerifyCode(phone, code);    return successResponse(      res,      {        user: {          id: user.id.toString(),           phone: user.phone,          nickname: user.nickname,          avatar: user.avatar,          createdAt: user.createdAt,          updatedAt: user.updatedAt,        },        token,      },      '登录成功'    );  } catch (error) {    console.error('❌ 登录失败:', error);    const errorMessage = error instanceof Error ? error.message : '登录失败';    if (errorMessage.includes('手机号格式')) {      return errorResponse(        res,        errorMessage,        StatusCode.INVALID_PHONE_NUMBER      );    } else if (errorMessage.includes('验证码已过期')) {      return errorResponse(        res,        errorMessage,        StatusCode.VERIFY_CODE_EXPIRED      );    } else if (errorMessage.includes('验证码错误')) {      return errorResponse(        res,        errorMessage,        StatusCode.VERIFY_CODE_ERROR      );    } else {      return errorResponse(        res,        errorMessage,        StatusCode.SERVER_ERROR      );    }  }};export const getCurrentUser = async (req: Request, res: Response): Promise<Response> => {  try {    const user = (req as any).user;    if (!user) {      return errorResponse(        res,        '用户信息获取失败',        StatusCode.UNAUTHORIZED      );    }    return successResponse(      res,      {        id: user.id.toString(),        phone: user.phone,        nickname: user.nickname,        avatar: user.avatar,        createdAt: user.createdAt,        updatedAt: user.updatedAt,      },      '获取成功'    );  } catch (error) {    console.error('❌ 获取用户信息失败:', error);    return errorResponse(      res,      '获取用户信息失败',      StatusCode.SERVER_ERROR    );  }};
